more fixes due to recent hasty huge backport